% !TEX program = pdflatex
%-------------------------
% Professional Cover Letter Template in LaTeX
% Author : iggymiggy
% License : MIT
%
% Cover letter template matching CV styling.
% Personal info from personal_info.tex, defaults from base_config.tex.
% Company-specific customizations are defined directly in companies/*/cover_letter.tex.
%------------------------

% Global document settings (paper size, etc.)
% Works when compiling from root, templates/, or companies/<name>/
% Define \loadfile helper before using it
\newcommand{\loadfile}[2]{%
  \IfFileExists{../../#1}{\input{../../#1}}{%
  \IfFileExists{../#1}{\input{../#1}}{%
  \IfFileExists{#1}{\input{#1}}{#2}}}%
}
\loadfile{document_settings.tex}{}

\documentclass{article}

% Load common package (shared packages, commands, and helpers)
\loadfile{templates/common.sty}{}

% Cover letter-specific packages
\usepackage{etoolbox}
\usepackage[finnish,english]{babel}
\usepackage[utf8]{inputenc}
% Note: glyphtounicode is not needed - \pdfgentounicode=1 in common.sty already handles Unicode encoding

%-------------------------------------------
%%%%%%  COVER LETTER STARTS HERE  %%%%%%%%%%%%%%%%%%%

% Load personal information
% Handles compilation from root, templates/, or companies/company_name/
\loadfile{personal_info.tex}{}

% Load base/default configuration first
% This provides default values for all cover letter fields
\loadfile{templates/base_config.tex}{}

% Default letter body (generic lorem ipsum)
% Companies can override \letterbody in their cover_letter.tex file
\providecommand{\letterbody}{%
  Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.

  \vspace{10pt}

  Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo.

  \vspace{10pt}

  At vero eos et accusamus et iusto odio dignissimos ducimus qui blanditiis praesentium voluptatum deleniti atque corrupti quos dolores et quas molestias excepturi sint occaecati cupiditate non provident.
}

% Validate configuration (checks for required fields and placeholder values)
% Note: This should be called after company-specific overrides in cover_letter.tex
% For base template, we validate here; company files should call it after their overrides
\validateconfigcoverletter

% Set PDF metadata including template version
\setpdfmetadata

\begin{document}

% Set up cover letter date (language selection and auto-date handling)
% Uses \letterdatelanguage and \letterdate (defined in base_config.tex or company cover_letter.tex)
\setupcoverletterdate

%-----------HEADING------------
\begin{center}
  {\Huge \textbf{\color{\cvthemeaccent}\myname}} \\
  \vspace{2pt}
  {\Large \color{\cvthemetitle}\cvtitle} \\
  \vspace{4pt}
  \href{\mylinkedinurl}{\faLinkedin\ linkedin.com/in/\mylinkedin} \quad
  \href{\mygithuburl}{\faGithub\ github.com/\mygithub} \quad
  \href{\myportfoliourl}{\faFolderOpen\ \myportfolio} \\
  \faEnvelope\ \href{mailto:\myemail}{\myemail} \quad
  \ifnotempty{\myphone}{\faPhone\ \href{tel:\myphone}{\myphone} \quad}{}%
  \ifnotempty{\mylocation}{\faMapMarker\ \cvcolor{primary}{\mylocation}}{} \\
\end{center}

\vspace{20pt}

%-----------COMPANY DETAILS AND DATE------------
\begin{tabular*}{\textwidth}{@{\extracolsep{\fill}}l@{\extracolsep{0pt}}r}
  \begin{minipage}[t]{0.52\textwidth}
    \small
    \raggedright
    \textbf{\companyrecipient} \\
    \cvcolor{primary}{\companyname} \\
    \cvcolor{primary}{\companyaddress} \\
    \cvcolor{primary}{\companycity} \\
  \end{minipage} &
  \begin{minipage}[t]{0.38\textwidth}
    \small
    \raggedleft
    \cvcolor{primary}{\letterdate} \\
  \end{minipage} \\
\end{tabular*}

\vspace{36pt}

%-----------LETTER TITLE AND OPENING------------
\noindent{\large\bfseries\underline{\lettertitle}} \\
\vspace{8pt}
\noindent \letteropening \\
\vspace{12pt}

%-----------LETTER CONTENT------------
% Content from base_config.tex default or company cover_letter.tex override
% Company configs can override \letterbody to reorder/add/remove sections.
\letterbody

\vspace{12pt}

%-----------LETTER CLOSING------------
\vspace{8pt}
\noindent \letterclosing, \\
\vspace{6pt}
\noindent\textbf{\myname} \\
\vspace{20pt}
\noindent\small\cvcolor{primary}{\textit{\letterattachment}}

%-------------------------------------------
\end{document}
