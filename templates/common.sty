% Common package for CV and Cover Letter templates
% Author : iggymiggy
% License : MIT
%
% This package contains all shared packages, settings, and custom commands
% used by both CV and cover letter templates.

%-------------------------
% Note: \loadfile helper macro is defined in each template/company file
% before loading this package, so it's available for use here.
%-------------------------
% Helper Macro for Empty Section Checking
%-------------------------
% \ifnotempty{command}{content if not empty}{content if empty}
%   Checks if a command expands to empty, and conditionally executes content.
%   @param #1: Command to check (e.g., \cvopensource)
%   @param #2: Content to display if command is not empty
%   @param #3: Content to display if command is empty
%   @example: \ifnotempty{\cvopensource}{\section{Open Source}\cvopensource}{}
%   @usage: Use to conditionally show/hide sections based on content
\newcommand{\ifnotempty}[3]{%
  \expandafter\def\expandafter\tempcheck\expandafter{#1}%
  \def\tempempty{}%
  \ifx\tempcheck\tempempty #3\else #2\fi%
}

%-------------------------
% Helper Macro for Conditional Section Visibility
%-------------------------
% \conditionalsection{command}{section content}
%   Shows a section only if the command is not empty.
%   Convenience wrapper around \ifnotempty that hides section when empty.
%   @param #1: Command to check (e.g., \cvopensource, \cvvolunteer)
%   @param #2: Section content to display if command is not empty
%   @example: \conditionalsection{\cvopensource}{\section{Open Source}\cvopensource}
%   @usage: Use to conditionally show optional CV sections
%   @note: If command is empty, nothing is displayed (no empty section)
\newcommand{\conditionalsection}[2]{%
  \ifnotempty{#1}{#2}{}%
}

%-------------------------
% Packages (shared by CV and Cover Letter)
%-------------------------
\RequirePackage{latexsym}
\RequirePackage[empty]{fullpage}
\RequirePackage{titlesec}
\RequirePackage{marvosym}
\RequirePackage[usenames,dvipsnames]{color}
\RequirePackage{xcolor}
\RequirePackage{verbatim}
\RequirePackage{enumitem}
\RequirePackage[hidelinks]{hyperref}
\RequirePackage{fancyhdr}
\RequirePackage{tabularx}
\RequirePackage{fontawesome5}  % Font awesome icons (LinkedIn and GitHub icons)

% Note: babel, inputenc, etoolbox, and glyphtounicode are loaded in templates
% as they may differ between CV and cover letter (e.g., cover letter uses finnish,english)
%
% Standardized glyphtounicode usage:
% - CV files: MUST use \input{glyphtounicode} (needed for ATS parsing of CVs)
% - Cover letter files: DO NOT use glyphtounicode - \pdfgentounicode=1 (set below) already handles Unicode

%-------------------------
% Page Setup
%-------------------------
\pagestyle{fancy}
\fancyhf{} % Clear all header and footer fields
\fancyfoot{}
\renewcommand{\headrulewidth}{0pt}
\renewcommand{\footrulewidth}{0pt}

% Adjust margins
\addtolength{\oddsidemargin}{-0.5in}
\addtolength{\evensidemargin}{-0.5in}
\addtolength{\textwidth}{1in}
\addtolength{\topmargin}{-.5in}
\addtolength{\textheight}{1.0in}

\urlstyle{same}

\raggedbottom
\raggedright
\setlength{\tabcolsep}{0in}

%-------------------------
% Section Formatting
%-------------------------
\titleformat{\section}{
  \vspace{-4pt}\scshape\raggedright\large
}{}{0em}{}[\color{black}\titlerule \vspace{-5pt}]

% Ensure that generate PDF is machine readable/ATS parsable
\pdfgentounicode=1

%-------------------------
% Custom CV/Resume Commands
%-------------------------

% \cvItem{label}{content}
%   Creates a list item with a bold label followed by content.
%   @param #1: Label text (displayed in bold)
%   @param #2: Content text (displayed after colon)
%   @example: \cvItem{Programming Languages}{Python, Java, C++}
%   @usage: Use inside \cvItemListStart ... \cvItemListEnd
\newcommand{\cvItem}[2]{%
  \item\small{%
    \textbf{#1}{: #2 \vspace{-2pt}}%
  }%
}

% \cvItemSimple{label}{content}
%   Creates a simple list item without a label (just content).
%   @param #1: Unused (kept for consistency with \cvItem)
%   @param #2: Content text
%   @example: \cvItemSimple{}{Implemented REST API with Flask}
%   @usage: Use inside \cvItemListStart ... \cvItemListEnd
\newcommand{\cvItemSimple}[2]{%
  \item\small{%
    #2 \vspace{-2pt}%
  }%
}

% \cvHeading{name}{right-align}{title}{right-align}
%   Creates a heading that does not need to be in a list.
%   Typically used for the main header section.
%   @param #1: Name or main text (left-aligned, bold)
%   @param #2: Right-aligned text (e.g., location, date)
%   @param #3: Title or subtitle (left-aligned, italic, small)
%   @param #4: Right-aligned subtitle (italic, small)
%   @example: \cvHeading{John Doe}{San Francisco, CA}{Software Engineer}{2020-Present}
%   @usage: Can be used standalone (not in a list)
\newcommand{\cvHeading}[4]{%
    \begin{tabular*}{0.99\textwidth}[t]{l@{\extracolsep{\fill}}r}%
      \textbf{#1} & #2 \\%
      \textit{\small#3} & \textit{\small #4} \\%
    \end{tabular*}\vspace{-5pt}%
}

% \cvSubheading{title}{date}{company}{location}
%   Creates a subheading used within lists (e.g., Experience, Education).
%   @param #1: Job title or degree name (bold)
%   @param #2: Date range (right-aligned)
%   @param #3: Company or institution name (italic, small, left-aligned)
%   @param #4: Location (italic, small, right-aligned)
%   @example: \cvSubheading{Senior Software Engineer}{2020-2023}{Google}{Mountain View, CA}
%   @usage: Use inside \cvSubHeadingListStart ... \cvSubHeadingListEnd
\newcommand{\cvSubheading}[4]{%
  \vspace{-1pt}\item%
    \begin{tabular*}{0.97\textwidth}[t]{l@{\extracolsep{\fill}}r}%
      \textbf{#1} & #2 \\%
      \textit{\small#3} & \textit{\small #4} \\%
    \end{tabular*}\vspace{-5pt}%
}

% \cvSubSubheading{position}{date}
%   Creates a sub-subheading for multiple positions at the same company.
%   Used when you have multiple roles at one company.
%   @param #1: Position title (italic, small, left-aligned)
%   @param #2: Date range (italic, small, right-aligned)
%   @example: \cvSubSubheading{Junior Software Engineer}{2018-2020}
%   @usage: Use after \cvSubheading for the same company
\newcommand{\cvSubSubheading}[2]{%
    \begin{tabular*}{0.97\textwidth}{l@{\extracolsep{\fill}}r}%
      \textit{\small#1} & \textit{\small #2} \\%
    \end{tabular*}\vspace{-5pt}%
}

% \cvSubheadingWithDetails{title}{date}{institution}{location}{major}{minor}
%   Creates a subheading with education details (major and minor).
%   Similar to \cvSubheading but includes major/minor fields.
%   @param #1: Degree name (bold)
%   @param #2: Date (right-aligned)
%   @param #3: Institution name (italic, small, left-aligned)
%   @param #4: Location (italic, small, right-aligned)
%   @param #5: Major field of study
%   @param #6: Minor field of study (can be empty)
%   @example: \cvSubheadingWithDetails{Bachelor of Science}{2014-2018}{MIT}{Cambridge, MA}{Computer Science}{Mathematics}
%   @usage: Use inside \cvSubHeadingListStart ... \cvSubHeadingListEnd for Education section
\newcommand{\cvSubheadingWithDetails}[6]{%
  \vspace{-1pt}\item%
    \begin{tabular*}{0.97\textwidth}[t]{l@{\extracolsep{\fill}}r}%
      \textbf{#1} & #2 \\%
      \textit{\small#3} & \textit{\small#4} \\%
    \end{tabular*}%
    \vspace{-3pt} % Adjust spacing as needed
    \begin{tabular*}{0.97\textwidth}[t]{l}%
      \textit{\small Major: #5 \hspace{20pt} Minor: #6} \\%
    \end{tabular*}%
    \vspace{-5pt} % Adjust spacing after details
}

% \cvSubItem{label}{content}
%   Creates a nested sub-item (used for bullet points under a main item).
%   @param #1: Label text (bold)
%   @param #2: Content text
%   @example: \cvSubItem{Technologies}{Python, Docker, Kubernetes}
%   @usage: Use inside \cvItemListStart ... \cvItemListEnd (nested within a main item)
\newcommand{\cvSubItem}[2]{\cvItem{#1}{#2}\vspace{-4pt}}

% List item marker (circular bullet for nested lists)
\renewcommand{\labelitemii}{$\circ$}

% \cvSubHeadingListStart ... \cvSubHeadingListEnd
%   Wrapper for itemize environment used for main sections (Experience, Education).
%   Uses leftmargin=* to remove left margin.
%   @usage: Wrap \cvSubheading commands
%   @example:
%     \cvSubHeadingListStart
%       \cvSubheading{Engineer}{2020-2023}{Company}{Location}
%     \cvSubHeadingListEnd
\newcommand{\cvSubHeadingListStart}{\begin{itemize}[leftmargin=*]}
\newcommand{\cvSubHeadingListEnd}{\end{itemize}}

% \cvItemListStart ... \cvItemListEnd
%   Wrapper for standard itemize environment used for bullet points.
%   @usage: Wrap \cvItem or \cvItemSimple commands
%   @example:
%     \cvItemListStart
%       \cvItem{Language}{Python}
%       \cvItem{Framework}{Django}
%     \cvItemListEnd
\newcommand{\cvItemListStart}{\begin{itemize}}
\newcommand{\cvItemListEnd}{\end{itemize}\vspace{-5pt}}

% \cvProjectItem{name}{type}{date}{description}
%   Creates a formatted project entry with name, type, date, and description.
%   @param #1: Project name (bold)
%   @param #2: Project type or category (italic)
%   @param #3: Date (right-aligned, italic, small)
%   @param #4: Project description (displayed as nested bullet)
%   @example: \cvProjectItem{Web App}{Personal Project}{2023}{Built with React and Node.js}
%   @usage: Use inside \cvItemListStart ... \cvItemListEnd
\newcommand{\cvProjectItem}[4]{%
  \item\small{%
    \textbf{#1} â€” \textit{#2} \hfill \textit{\small #3}%
  }%
  \vspace{-4pt}%
  \begin{itemize}[leftmargin=1em]%
    \item\small{#4 \vspace{-2pt}}%
  \end{itemize}%
}

%-------------------------
% Certificates Section
%-------------------------
% \cvCertificates{content}
%   Creates a formatted certificates section with two-column layout.
%   @param #1: Certificate entries (each entry should end with \\)
%   @example:
%     \cvCertificates{%
%       \textbf{AWS Certified} & \textcolor{gray}{\textit{2023}} \\
%       \textbf{Kubernetes Admin} & \textcolor{gray}{\textit{2022}} \\
%     }
%   @note: Use \href{url}{\textbf{Name}} for clickable certificate links
%   @usage: Call directly in CV body (not inside a list)
\newcommand{\cvCertificates}[1]{%
  \vspace{-4pt}%
  \section*{Certificates}%
  \vspace{-3pt}%
  \begin{tabularx}{\textwidth}{X r} % Two-column layout
    #1
  \end{tabularx}%
  \vspace{-5pt} % Reduce bottom space
}

%-------------------------
% Cover Letter Section Command
%-------------------------
% \lettersection{title}
%   Creates a section heading for cover letter with a horizontal rule.
%   Used to separate different parts of the cover letter body.
%   @param #1: Section title (displayed in large, bold)
%   @example: \lettersection{Why I'm a Great Fit}
%   @usage: Use in cover letter body to create section breaks
%   @note: Can be overridden in company cover_letter.tex for custom styling
\newcommand{\lettersection}[1]{%
  \vspace{12pt}%
  \noindent{\large\bfseries #1} \textcolor{gray}{\hrulefill} \\%
  \vspace{6pt}%
}

%-------------------------
% Cover Letter Date Setup Helper
%-------------------------
% Sets up date language and handles auto-date conversion
% Uses \letterdatelanguage and \letterdate commands (should be defined in cover_letter.tex)
% This centralizes the date handling logic while keeping values company-specific
%
% Note: babel package must be loaded with the desired languages (e.g., [finnish,english])
% The language name in \letterdatelanguage must match a language loaded in babel
\newcommand{\setupcoverletterdate}{%
  % Set date language (from \letterdatelanguage, company-specific)
  % Uses babel's \selectlanguage directly - works with any language loaded in babel
  \selectlanguage{\letterdatelanguage}%
  % Set date (auto uses \today, respects language setting)
  \def\checkdateauto{auto}%
  \edef\letterdateexpanded{\letterdate}%
  \ifx\letterdateexpanded\checkdateauto
    \renewcommand{\letterdate}{\today}%
  \fi
}

