% Common package for CV and Cover Letter templates
% Author : iggymiggy
% License : MIT
%
% This package contains all shared packages, settings, and custom commands
% used by both CV and cover letter templates.

%-------------------------
% Note: \loadfile helper macro is defined in each template/company file
% before loading this package, so it's available for use here.
%-------------------------
% Helper Macro for Empty Section Checking
%-------------------------
% Checks if a command expands to empty, and conditionally executes content
% Usage: \ifnotempty{\command}{\content if not empty}{\content if empty}
\newcommand{\ifnotempty}[3]{%
  \expandafter\def\expandafter\tempcheck\expandafter{#1}%
  \def\tempempty{}%
  \ifx\tempcheck\tempempty #3\else #2\fi%
}

%-------------------------
% Helper Macro for Conditional Section Visibility
%-------------------------
% Shows a section only if the command is not empty
% Usage: \conditionalsection{\command}{\section content}
% Example: \conditionalsection{\cvopensource}{\section{Open Source}\cvopensource}
\newcommand{\conditionalsection}[2]{%
  \ifnotempty{#1}{#2}{}%
}

%-------------------------
% Packages (shared by CV and Cover Letter)
%-------------------------
\RequirePackage{latexsym}
\RequirePackage[empty]{fullpage}
\RequirePackage{titlesec}
\RequirePackage{marvosym}
\RequirePackage[usenames,dvipsnames]{color}
\RequirePackage{xcolor}
\RequirePackage{verbatim}
\RequirePackage{enumitem}
\RequirePackage[hidelinks]{hyperref}
\RequirePackage{fancyhdr}
\RequirePackage{tabularx}
\RequirePackage{fontawesome5}  % Font awesome icons (LinkedIn and GitHub icons)

% Note: babel, inputenc, etoolbox, and glyphtounicode are loaded in templates
% as they may differ between CV and cover letter (e.g., cover letter uses finnish,english)
%
% Standardized glyphtounicode usage:
% - CV files: MUST use \input{glyphtounicode} (needed for ATS parsing of CVs)
% - Cover letter files: DO NOT use glyphtounicode - \pdfgentounicode=1 (set below) already handles Unicode

%-------------------------
% Page Setup
%-------------------------
\pagestyle{fancy}
\fancyhf{} % Clear all header and footer fields
\fancyfoot{}
\renewcommand{\headrulewidth}{0pt}
\renewcommand{\footrulewidth}{0pt}

% Adjust margins
\addtolength{\oddsidemargin}{-0.5in}
\addtolength{\evensidemargin}{-0.5in}
\addtolength{\textwidth}{1in}
\addtolength{\topmargin}{-.5in}
\addtolength{\textheight}{1.0in}

\urlstyle{same}

\raggedbottom
\raggedright
\setlength{\tabcolsep}{0in}

%-------------------------
% Section Formatting
%-------------------------
\titleformat{\section}{
  \vspace{-4pt}\scshape\raggedright\large
}{}{0em}{}[\color{black}\titlerule \vspace{-5pt}]

% Ensure that generate PDF is machine readable/ATS parsable
\pdfgentounicode=1

%-------------------------
% Custom CV/Resume Commands
%-------------------------

% Basic item with label
\newcommand{\cvItem}[2]{%
  \item\small{%
    \textbf{#1}{: #2 \vspace{-2pt}}%
  }%
}

% Simple item without label
\newcommand{\cvItemSimple}[2]{%
  \item\small{%
    #2 \vspace{-2pt}%
  }%
}

% Heading that does not need to be in a list
\newcommand{\cvHeading}[4]{%
    \begin{tabular*}{0.99\textwidth}[t]{l@{\extracolsep{\fill}}r}%
      \textbf{#1} & #2 \\%
      \textit{\small#3} & \textit{\small #4} \\%
    \end{tabular*}\vspace{-5pt}%
}

% Subheading (used in lists)
\newcommand{\cvSubheading}[4]{%
  \vspace{-1pt}\item%
    \begin{tabular*}{0.97\textwidth}[t]{l@{\extracolsep{\fill}}r}%
      \textbf{#1} & #2 \\%
      \textit{\small#3} & \textit{\small #4} \\%
    \end{tabular*}\vspace{-5pt}%
}

% Sub-subheading (for multiple positions at same company)
\newcommand{\cvSubSubheading}[2]{%
    \begin{tabular*}{0.97\textwidth}{l@{\extracolsep{\fill}}r}%
      \textit{\small#1} & \textit{\small #2} \\%
    \end{tabular*}\vspace{-5pt}%
}

% Subheading with education details (major/minor)
\newcommand{\cvSubheadingWithDetails}[6]{%
  \vspace{-1pt}\item%
    \begin{tabular*}{0.97\textwidth}[t]{l@{\extracolsep{\fill}}r}%
      \textbf{#1} & #2 \\%
      \textit{\small#3} & \textit{\small#4} \\%
    \end{tabular*}%
    \vspace{-3pt} % Adjust spacing as needed
    \begin{tabular*}{0.97\textwidth}[t]{l}%
      \textit{\small Major: #5 \hspace{20pt} Minor: #6} \\%
    \end{tabular*}%
    \vspace{-5pt} % Adjust spacing after details
}

% Sub-item (nested item)
\newcommand{\cvSubItem}[2]{\cvItem{#1}{#2}\vspace{-4pt}}

% List item marker
\renewcommand{\labelitemii}{$\circ$}

% List start/end commands
\newcommand{\cvSubHeadingListStart}{\begin{itemize}[leftmargin=*]}
\newcommand{\cvSubHeadingListEnd}{\end{itemize}}
\newcommand{\cvItemListStart}{\begin{itemize}}
\newcommand{\cvItemListEnd}{\end{itemize}\vspace{-5pt}}

% Project item
\newcommand{\cvProjectItem}[4]{%
  \item\small{%
    \textbf{#1} â€” \textit{#2} \hfill \textit{\small #3}%
  }%
  \vspace{-4pt}%
  \begin{itemize}[leftmargin=1em]%
    \item\small{#4 \vspace{-2pt}}%
  \end{itemize}%
}

%-------------------------
% Certificates Section
%-------------------------
\newcommand{\cvCertificates}[1]{%
  \vspace{-4pt}%
  \section*{Certificates}%
  \vspace{-3pt}%
  \begin{tabularx}{\textwidth}{X r} % Two-column layout
    #1
  \end{tabularx}%
  \vspace{-5pt} % Reduce bottom space
}

%-------------------------
% Cover Letter Section Command
%-------------------------
% Letter section command with full page line (emphasized)
\newcommand{\lettersection}[1]{%
  \vspace{12pt}%
  \noindent{\large\bfseries #1} \textcolor{gray}{\hrulefill} \\%
  \vspace{6pt}%
}

%-------------------------
% Cover Letter Date Setup Helper
%-------------------------
% Sets up date language and handles auto-date conversion
% Uses \letterdatelanguage and \letterdate commands (should be defined in cover_letter.tex)
% This centralizes the date handling logic while keeping values company-specific
%
% Note: babel package must be loaded with the desired languages (e.g., [finnish,english])
% The language name in \letterdatelanguage must match a language loaded in babel
\newcommand{\setupcoverletterdate}{%
  % Set date language (from \letterdatelanguage, company-specific)
  % Uses babel's \selectlanguage directly - works with any language loaded in babel
  \selectlanguage{\letterdatelanguage}%
  % Set date (auto uses \today, respects language setting)
  \def\checkdateauto{auto}%
  \edef\letterdateexpanded{\letterdate}%
  \ifx\letterdateexpanded\checkdateauto
    \renewcommand{\letterdate}{\today}%
  \fi
}

